(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[558],{3741:(e,t,r)=>{"use strict";r.d(t,{$:()=>l});var a=r(5155);function l(e){let{variant:t="primary",className:r="",...l}=e;return(0,a.jsx)("button",{className:"".concat("inline-flex items-center justify-center rounded-md transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none"," ").concat({primary:"bg-gradient-to-r from-[#7C3AED] via-[#2563EB] to-[#06B6D4] text-white shadow-[0_0_0_1px_rgba(255,255,255,0.15)] hover:opacity-95 focus-visible:ring-[#7C3AED]",glass:"backdrop-blur bg-white/10 dark:bg-white/5 text-white border border-white/15 hover:bg-white/15",outline:"border border-white/20 text-white/90 hover:bg-white/10"}[t]," ").concat(r),...l})}},3915:(e,t,r)=>{"use strict";r.d(t,{p:()=>l});var a=r(5155);let l=(0,r(2115).forwardRef)(function(e,t){let{className:r="",...l}=e;return(0,a.jsx)("input",{ref:t,className:"w-full rounded-md border border-white/15 bg-white/10 text-white placeholder:text-white/40 px-3 py-2 outline-none focus:ring-2 focus:ring-[#7C3AED]/40 ".concat(r),...l})})},4054:(e,t,r)=>{"use strict";r.d(t,{AudioEditor:()=>o});var a=r(5155),l=r(2115),i=r(3741),n=r(3915);function o(){let e=(0,l.useRef)(null),t=(0,l.useRef)(null),r=(0,l.useRef)(null),o=(0,l.useRef)(new Map),d=(0,l.useRef)(new Map),s=(0,l.useRef)(new Map),[c,u]=(0,l.useState)(!1),[h,g]=(0,l.useState)(0),[f,m]=(0,l.useState)(0),[x,b]=(0,l.useState)([]),[p,y]=(0,l.useState)([]),[v,w]=(0,l.useState)(null),[j,T]=(0,l.useState)(1),[k,N]=(0,l.useState)(null),[S,C]=(0,l.useState)(!1),[I,M]=(0,l.useState)(!1),[D,R]=(0,l.useState)(null),[E,P]=(0,l.useState)(null),[O,A]=(0,l.useState)(null),[L,B]=(0,l.useState)(!1),[F,V]=(0,l.useState)(null),[z,_]=(0,l.useState)(!1),[U,X]=(0,l.useState)(null),[W,$]=(0,l.useState)(!1),[G,Y]=(0,l.useState)(0),[H,q]=(0,l.useState)(0),[J,K]=(0,l.useState)(null),[Q,Z]=(0,l.useState)(new Map),ee=["rgba(99, 102, 241, 0.8)","rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)","rgba(168, 85, 247, 0.8)","rgba(6, 182, 212, 0.8)","rgba(251, 146, 60, 0.8)"],et=Math.max(...x.map(e=>e.duration),...p.map(e=>e.endTime),0);(0,l.useEffect)(()=>{r.current||(r.current=new(window.AudioContext||window.webkitAudioContext)({sampleRate:44100,latencyHint:"interactive"}))},[]);let er=()=>{if(!r.current||!c)return;let e=p.filter(e=>h>=e.startTime&&h<e.endTime),t=Array.from(d.current.keys()),a=e.map(e=>e.id).sort(),l=t.sort(),i=a.length!==l.length||!a.every((e,t)=>e===l[t]);t.length;let n=e.length>0,u=t.length>0;!i&&u&&n||(console.log("Audio restart decision:",{currentTime:h.toFixed(2),activeClips:a,currentClips:l,clipsChanged:i,shouldHaveAudio:n,hasAudio:u,willRestart:i||!u||!n}),d.current.forEach(e=>{try{e.stop()}catch(e){}}),d.current.clear(),s.current.clear(),e.length>0?console.log("Active clips at time",h.toFixed(2),":",e.map(e=>"".concat(e.name," (").concat(e.startTime.toFixed(2),"-").concat(e.endTime.toFixed(2),")"))):console.log("No active clips at time",h.toFixed(2),"Available clips:",p.map(e=>"".concat(e.name," (").concat(e.startTime.toFixed(2),"-").concat(e.endTime.toFixed(2),")"))),e.forEach(e=>{let t=x.find(t=>t.id===e.trackId);if(!t||t.muted)return;let a=e.originalTrackId||t.id,l=o.current.get(a);if(!l)return;let i=r.current.createBufferSource(),n=r.current.createGain();if(i.buffer=l,i.connect(n),n.connect(r.current.destination),n.gain.value=t.volume*e.volume,Q.get(a)){let t=h-e.startTime,r=Math.max(0,t),a=Math.min(l.duration,e.endTime-e.startTime)-r;console.log("Playing split clip: ".concat(e.name,", timeInClip: ").concat(t.toFixed(2),", bufferStart: ").concat(r.toFixed(2),", duration: ").concat(a.toFixed(2))),a>0&&(i.start(0,r,a),d.current.set(e.id,i),s.current.set(e.id,n))}else{let t=Math.max(0,h-e.startTime),r=Math.min(l.duration,e.endTime-e.startTime)-t;r>0&&(i.start(0,t,r),d.current.set(e.id,i),s.current.set(e.id,n))}}))};(0,l.useEffect)(()=>{if(c&&r.current){let e=setTimeout(()=>{er()},100);return()=>clearTimeout(e)}},[p,x,c]),(0,l.useEffect)(()=>{c&&r.current&&er()},[h,c]),(0,l.useEffect)(()=>{if(c&&r.current){let e=setTimeout(()=>{er()},200);return()=>clearTimeout(e)}},[h]),(0,l.useEffect)(()=>{if(!c)return;let e=Date.now()-1e3*h,t=setInterval(()=>{let t=Math.min((Date.now()-e)/1e3,et);if(t>=et){u(!1),g(0);return}g(t)},16);return()=>clearInterval(t)},[c,et,h]),(0,l.useEffect)(()=>{let e=e=>{let t=e.target;!J||t.closest(".dropdown-menu")||t.closest(".dropdown-trigger")||K(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[J]);let ea=async e=>{try{let t=await e.arrayBuffer(),r=new(window.AudioContext||window.webkitAudioContext),a=(await r.decodeAudioData(t)).getChannelData(0),l=Math.floor(a.length/5e3),i=[];for(let e=0;e<5e3;e++){let t=l*e,r=0;for(let e=0;e<l;e++)r+=Math.abs(a[t+e]);i.push(r/l)}return i}catch(t){console.error("Error generating waveform:",t);let e=[];for(let t=0;t<5e3;t++)e.push(.3*Math.sin(.1*t)+.3);return e}},el=async e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(a){if(!a.type.startsWith("audio/"))return void N("Please select an audio file");M(!0),N(null);try{let e=URL.createObjectURL(a),t=await ea(a),l=await a.arrayBuffer();if(!r.current)throw Error("Audio context not initialized");let i=await r.current.decodeAudioData(l,e=>{console.log("Audio decoded successfully:",{sampleRate:e.sampleRate,duration:e.duration,numberOfChannels:e.numberOfChannels})},e=>{throw console.error("Audio decode error:",e),Error("Failed to decode audio file")}),n=Date.now().toString();o.current.set(n,i),Z(e=>{let t=new Map(e);return t.set(n,{buffer:i,originalTrackId:n,startSample:0,endSample:i.length,originalDuration:i.duration}),t}),"suspended"===r.current.state&&await r.current.resume();let d={id:n,name:a.name.replace(/\.[^/.]+$/,""),file:a,url:e,duration:i.duration,waveformData:t,color:ee[x.length%ee.length],volume:1,muted:!1,soloed:!1,leftChannel:!0,rightChannel:!0};b(e=>[...e,d]);let s={id:Date.now().toString(),trackId:d.id,startTime:0,endTime:i.duration,name:d.name,volume:1,fadeIn:0,fadeOut:0,originalTrackId:d.id};y(e=>[...e,s]),m(Math.max(f,i.duration)),M(!1)}catch(e){N("Error loading audio file"),M(!1)}}},ei=async()=>{if(x.length>0&&r.current)try{"suspended"===r.current.state&&await r.current.resume(),u(!0),setTimeout(()=>er(),50)}catch(e){console.error("Error starting playback:",e),N("Error starting playback")}},en=async()=>{if(0===x.length)return void N("Please add audio tracks first");C(!0),N(null);try{let e=new FormData;e.append("file",x[0].file);let t=await fetch("/api/master/quick",{method:"POST",body:e});if(!t.ok)throw Error("Mastering failed");let r=await t.blob(),a=URL.createObjectURL(r),l=document.createElement("a");l.href=a,l.download="mastered_audio.wav",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a)}catch(e){N("Mastering failed: "+e.message)}finally{C(!1)}},eo=e=>{let t=Math.floor(e/60),r=Math.floor(e%60),a=Math.floor(e%1*1e3);return"".concat(t.toString().padStart(2,"0"),":").concat(r.toString().padStart(2,"0"),":").concat(a.toString().padStart(3,"0"))};return(0,l.useEffect)(()=>{(()=>{let e=t.current;if(!e)return;let r=e.getContext("2d");if(!r)return;r.clearRect(0,0,e.width,e.height);let a=r.createLinearGradient(0,0,0,e.height);a.addColorStop(0,"rgba(20, 20, 20, 1)"),a.addColorStop(1,"rgba(10, 10, 10, 1)"),r.fillStyle=a,r.fillRect(0,0,e.width,e.height),r.strokeStyle="rgba(255, 255, 255, 0.1)",r.lineWidth=1;for(let t=0;t<e.width;t+=50)r.beginPath(),r.moveTo(t,0),r.lineTo(t,e.height),r.stroke();for(let t=0;t<e.height;t+=50)r.beginPath(),r.moveTo(0,t),r.lineTo(e.width,t),r.stroke();if(x.forEach((t,a)=>{let l=120*a;if(r.fillStyle="rgba(255, 255, 255, 0.02)",r.fillRect(0,l,e.width,120),r.strokeStyle="rgba(255, 255, 255, 0.1)",r.lineWidth=1,r.strokeRect(0,l,e.width,120),r.fillStyle="rgba(255, 255, 255, 0.9)",r.font="bold 12px system-ui",r.fillText(t.name,10,l+20),r.fillStyle=t.muted?"rgba(255, 0, 0, 0.8)":"rgba(0, 255, 0, 0.8)",r.fillText(t.muted?"M":"●",e.width-80,l+20),r.fillStyle=t.soloed?"rgba(255, 255, 0, 0.8)":"rgba(255, 255, 255, 0.4)",r.fillText(t.soloed?"S":"○",e.width-60,l+20),r.fillStyle=t.leftChannel?"rgba(0, 255, 0, 0.8)":"rgba(255, 0, 0, 0.8)",r.fillText("L",e.width-40,l+20),r.fillStyle=t.rightChannel?"rgba(0, 255, 0, 0.8)":"rgba(255, 0, 0, 0.8)",r.fillText("R",e.width-20,l+20),t.waveformData&&t.waveformData.length>0){let a=l+40,i=e.width/t.waveformData.length;r.fillStyle="rgba(255, 255, 255, 0.05)",r.fillRect(0,a,e.width,60),r.strokeStyle=t.color,r.lineWidth=1,r.beginPath(),t.waveformData.forEach((e,t)=>{let l=t*i,n=a+30+60*e/2;0===t?r.moveTo(l,n):r.lineTo(l,n)}),r.stroke()}p.filter(e=>e.trackId===t.id).forEach(t=>{let a=t.startTime/et*e.width*j,i=(t.endTime-t.startTime)/et*e.width*j,n=v===t.id;r.fillStyle=n?"rgba(0, 123, 255, 0.3)":"rgba(255, 255, 255, 0.1)",r.fillRect(a,l+40,i,60),r.strokeStyle=n?"rgba(0, 123, 255, 0.8)":"rgba(255, 255, 255, 0.4)",r.lineWidth=n?3:1,r.strokeRect(a,l+40,i,60),n&&(r.fillStyle="rgba(0, 123, 255, 0.8)",r.fillRect(a,l+40,3,60),r.fillStyle="rgba(255, 255, 255, 0.9)",r.fillRect(a,l+40,8,60),r.fillRect(a+i-8,l+40,8,60),r.fillStyle="rgba(0, 0, 0, 0.7)",r.fillRect(a+2,l+45,4,50),r.fillRect(a+i-6,l+45,4,50)),r.fillStyle="rgba(255, 255, 255, 0.9)",r.font="10px system-ui",r.fillText(t.name,a+5,l+60),t.fadeIn>0&&(r.fillStyle="rgba(255, 255, 255, 0.3)",r.fillRect(a,l+40,10,60)),t.fadeOut>0&&(r.fillStyle="rgba(255, 255, 255, 0.3)",r.fillRect(a+i-10,l+40,10,60))})}),null!==E&&null!==O){let t=E/et*e.width*j,a=O/et*e.width*j-t;r.fillStyle="rgba(0, 123, 255, 0.3)",r.fillRect(t,0,a,e.height),r.strokeStyle="rgba(0, 123, 255, 0.8)",r.lineWidth=2,r.strokeRect(t,0,a,e.height)}if(et>0){let t=h/et*e.width*j;r.strokeStyle="rgba(255, 255, 255, 0.9)",r.lineWidth=2,r.beginPath(),r.moveTo(t,0),r.lineTo(t,e.height),r.stroke(),r.fillStyle="rgba(255, 255, 255, 0.9)",r.beginPath(),r.arc(t,15,6,0,2*Math.PI),r.fill()}z&&(r.fillStyle="rgba(0, 123, 255, 0.3)",r.fillRect(0,0,e.width,30),r.fillStyle="rgba(0, 123, 255, 0.8)",r.font="bold 12px system-ui",r.fillText("SELECTION MODE ACTIVE",10,20)),W&&F&&(r.fillStyle="rgba(255, 255, 255, 0.1)",r.fillRect(0,0,e.width,e.height),r.fillStyle="rgba(0, 123, 255, 0.8)",r.font="bold 14px system-ui",r.fillText("DRAGGING CLIP - Drop to move or resize",10,25))})()},[h,x,p,v,j,et,E,O,z,W,F,U]),(0,a.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white",children:[(0,a.jsx)("div",{className:"bg-gray-800 border-b border-gray-700 px-4 py-2",children:(0,a.jsxs)("div",{className:"flex items-center space-x-6 text-sm",children:[(0,a.jsx)("button",{className:"hover:text-blue-400",children:"File"}),(0,a.jsx)("button",{className:"hover:text-blue-400",children:"Edit"}),(0,a.jsx)("button",{className:"hover:text-blue-400",children:"Effects"}),(0,a.jsx)("button",{className:"hover:text-blue-400",children:"View"}),(0,a.jsx)("button",{className:"hover:text-blue-400",children:"Help"})]})}),(0,a.jsx)("div",{className:"bg-gradient-to-r from-gray-900/80 via-gray-800/80 to-gray-900/80 backdrop-blur-2xl border-b border-gray-600/30 px-6 py-4 shadow-2xl relative z-20",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"bg-gray-800/50 backdrop-blur-xl px-4 py-2 rounded-xl border border-gray-600/30",children:(0,a.jsx)("span",{className:"font-mono text-sm text-gray-200",children:eo(h)})}),(0,a.jsx)("div",{className:"bg-gray-800/50 backdrop-blur-xl px-4 py-2 rounded-xl border border-gray-600/30",children:(0,a.jsx)("span",{className:"font-mono text-sm text-gray-200",children:eo(et)})})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"flex items-center bg-gray-800/50 backdrop-blur-xl rounded-2xl p-2 border border-gray-600/30 shadow-lg",children:[(0,a.jsx)("button",{onClick:()=>{u(!1),g(0),d.current.forEach(e=>{try{e.stop()}catch(e){}}),d.current.clear()},className:"w-10 h-10 bg-gradient-to-br from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 rounded-xl border border-gray-600/30 flex items-center justify-center text-gray-300 hover:text-white transition-all duration-200 shadow-inner",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("rect",{x:"6",y:"6",width:"8",height:"8"})})}),(0,a.jsx)("button",{onClick:ei,disabled:c||0===x.length,className:"w-12 h-12 bg-gradient-to-br from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 disabled:from-gray-700 disabled:to-gray-800 rounded-xl border border-blue-500/30 flex items-center justify-center text-white disabled:text-gray-500 transition-all duration-200 shadow-lg mx-2",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M8 5v10l8-5-8-5z"})})}),(0,a.jsx)("button",{onClick:()=>{u(!1),d.current.forEach(e=>{try{e.stop()}catch(e){}}),d.current.clear()},disabled:!c,className:"w-10 h-10 bg-gradient-to-br from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 disabled:from-gray-700 disabled:to-gray-800 rounded-xl border border-gray-600/30 flex items-center justify-center text-gray-300 hover:text-white disabled:text-gray-500 transition-all duration-200 shadow-inner",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M6 4h2v12H6V4zm6 0h2v12h-2V4z"})})})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{g(e=>Math.max(0,e-5))},className:"w-8 h-8 bg-gradient-to-br from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 rounded-lg border border-gray-600/30 flex items-center justify-center text-gray-300 hover:text-white transition-all duration-200",children:(0,a.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M4.555 5.168A1 1 0 003 6v8a1 1 0 001.555.832L10 11V16a1 1 0 001.555.832L18 13V16a1 1 0 102-1.664L12 14v-3l4 2.664V7l-4 2.664V8l-4-2.664V4l4 2.664V3a1 1 0 00-1.555-.832L4.555 5.168z"})})}),(0,a.jsx)("button",{onClick:()=>{g(e=>Math.min(et,e+5))},className:"w-8 h-8 bg-gradient-to-br from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 rounded-lg border border-gray-600/30 flex items-center justify-center text-gray-300 hover:text-white transition-all duration-200",children:(0,a.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M15.445 5.168A1 1 0 0017 6v8a1 1 0 01-1.555.832L10 11V16a1 1 0 01-1.555.832L2 13V16a1 1 0 11-2-1.664L8 14v-3L4 13.664V7l4 2.664V8l4-2.664V4l-4 2.664V3a1 1 0 011.555-.832L15.445 5.168z"})})})]}),(0,a.jsx)("button",{onClick:()=>{console.log("Record pressed")},className:"w-10 h-10 bg-gradient-to-br from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 rounded-xl border border-red-500/30 flex items-center justify-center text-white transition-all duration-200 shadow-lg",children:(0,a.jsx)("div",{className:"w-4 h-4 bg-white rounded-full"})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(n.p,{type:"file",accept:"audio/*",onChange:el,className:"hidden",id:"direct-file-upload"}),(0,a.jsx)("button",{onClick:e=>{var t;e.stopPropagation(),null==(t=document.getElementById("direct-file-upload"))||t.click()},className:"w-10 h-10 bg-gradient-to-br from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 rounded-xl border border-green-500/30 flex items-center justify-center text-white transition-all duration-200 shadow-lg",title:"Upload Audio File",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z",clipRule:"evenodd"})})})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,a.jsxs)("div",{className:"relative dropdown-trigger",children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),K("file"===J?null:"file")},className:"px-4 py-2 bg-gradient-to-br from-gray-800/50 to-gray-700/50 hover:from-gray-700/50 hover:to-gray-600/50 rounded-xl border border-gray-600/30 text-gray-300 hover:text-white transition-all duration-200 backdrop-blur-xl",children:"File"}),"file"===J&&(0,a.jsxs)("div",{className:"fixed top-0 left-0 mt-2 w-48 bg-gray-800/90 backdrop-blur-xl rounded-xl border border-gray-600/30 shadow-2xl z-[99999] dropdown-menu",style:{top:"120px",left:"50%",transform:"translateX(-50%)"},children:[(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),b([]),y([]),w(null),P(null),A(null),e.current&&(e.current.src=""),K(null)},className:"w-full px-4 py-3 text-left text-gray-300 hover:text-white hover:bg-gray-700/50 transition-colors duration-200 rounded-t-xl",children:"New Project"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(n.p,{type:"file",accept:"audio/*",onChange:el,className:"hidden",id:"file-upload"}),(0,a.jsx)("button",{onClick:e=>{var t;e.stopPropagation(),null==(t=document.getElementById("file-upload"))||t.click(),K(null)},className:"w-full px-4 py-3 text-left text-gray-300 hover:text-white hover:bg-gray-700/50 transition-colors duration-200",children:"Open File"})]}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),en(),K(null)},disabled:0===x.length||S,className:"w-full px-4 py-3 text-left text-gray-300 hover:text-white hover:bg-gray-700/50 disabled:text-gray-500 disabled:hover:bg-transparent transition-colors duration-200",children:"Export Master"}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),b([]),y([]),w(null),P(null),A(null),e.current&&(e.current.src=""),K(null)},className:"w-full px-4 py-3 text-left text-gray-300 hover:text-white hover:bg-gray-700/50 transition-colors duration-200 rounded-b-xl",children:"Clear All"})]})]}),(0,a.jsxs)("div",{className:"relative dropdown-trigger",children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),K("edit"===J?null:"edit")},className:"px-4 py-2 bg-gradient-to-br from-gray-800/50 to-gray-700/50 hover:from-gray-700/50 hover:to-gray-600/50 rounded-xl border border-gray-600/30 text-gray-300 hover:text-white transition-all duration-200 backdrop-blur-xl",children:"Edit"}),"edit"===J&&(0,a.jsxs)("div",{className:"fixed top-0 left-0 mt-2 w-48 bg-gray-800/90 backdrop-blur-xl rounded-xl border border-gray-600/30 shadow-2xl z-[99999] dropdown-menu",style:{top:"120px",left:"50%",transform:"translateX(-50%)"},children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),(()=>{if(0===x.length)return N("Please add audio tracks first");let e=p.find(e=>h>=e.startTime&&h<=e.endTime);if(!e)return N("No clip found at current playhead position");if(h>e.startTime&&h<e.endTime){let t=d.current.get(e.id);if(t){try{t.stop()}catch(e){}d.current.delete(e.id)}let a=x.find(t=>t.id===e.trackId),l=Q.get(a.id);if(l&&r.current){let t=h-e.startTime,a=l.buffer.sampleRate,i=Math.floor(t*a),n=l.startSample+i;l.endSample;let d=r.current.createBuffer(l.buffer.numberOfChannels,i,a),s=r.current.createBuffer(l.buffer.numberOfChannels,l.buffer.length-n,a);for(let e=0;e<l.buffer.numberOfChannels;e++){let t=l.buffer.getChannelData(e),r=d.getChannelData(e),a=s.getChannelData(e);for(let e=0;e<i;e++)r[e]=t[l.startSample+e];for(let e=0;e<l.buffer.length-n;e++)a[e]=t[n+e]}let u="split_".concat(Date.now(),"_1"),g="split_".concat(Date.now(),"_2");o.current.set(u,d),o.current.set(g,s),Z(e=>{let t=new Map(e);return t.set(u,{buffer:d,originalTrackId:l.originalTrackId,startSample:l.startSample,endSample:n,originalDuration:l.originalDuration}),t.set(g,{buffer:s,originalTrackId:l.originalTrackId,startSample:n,endSample:l.endSample,originalDuration:l.originalDuration}),t});let f={id:Date.now().toString(),trackId:e.trackId,startTime:e.startTime,endTime:h,name:"".concat(e.name," (Part 1)"),volume:e.volume,fadeIn:e.fadeIn,fadeOut:0,originalTrackId:u},m={id:(Date.now()+1).toString(),trackId:e.trackId,startTime:h,endTime:e.endTime,name:"".concat(e.name," (Part 2)"),volume:e.volume,fadeIn:0,fadeOut:e.fadeOut,originalTrackId:g};y(t=>t.filter(t=>t.id!==e.id).concat([f,m])),w(f.id),c&&setTimeout(()=>er(),50)}}})(),K(null)},disabled:0===x.length,className:"w-full px-4 py-3 text-left text-gray-300 hover:text-white hover:bg-gray-700/50 disabled:text-gray-500 disabled:hover:bg-transparent transition-colors duration-200 rounded-t-xl",children:"Split at Playhead"}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),(()=>{if(!v||!E||!O)return N("Please select a clip and make a selection first");let e=p.find(e=>e.id===v);if(!e)return;let t=Math.max(e.startTime,E),r=Math.min(e.endTime,O);if(t>=r)return N("Invalid selection for cutting");let a={id:Date.now().toString(),trackId:e.trackId,startTime:t,endTime:r,name:"".concat(e.name," (Cut)"),volume:e.volume,fadeIn:0,fadeOut:0,originalTrackId:e.originalTrackId},l={...e};if(t===e.startTime)l.startTime=r;else if(r===e.endTime)l.endTime=t;else{let a={id:(Date.now()+1).toString(),trackId:e.trackId,startTime:r,endTime:e.endTime,name:"".concat(e.name," (Part 2)"),volume:e.volume,fadeIn:0,fadeOut:e.fadeOut,originalTrackId:e.originalTrackId};y(e=>[...e,a]),l.endTime=t}y(e=>e.map(e=>e.id===v?l:e)),y(e=>[...e,a]),w(a.id)})(),K(null)},disabled:!v||!E||!O,className:"w-full px-4 py-3 text-left text-gray-300 hover:text-white hover:bg-gray-700/50 disabled:text-gray-500 disabled:hover:bg-transparent transition-colors duration-200",children:"Cut Selection"}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),(()=>{if(!v)return N("Please select a clip first");let e=p.find(e=>e.id===v);e&&R(e)})(),K(null)},disabled:!v,className:"w-full px-4 py-3 text-left text-gray-300 hover:text-white hover:bg-gray-700/50 disabled:text-gray-500 disabled:hover:bg-transparent transition-colors duration-200",children:"Copy"}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),(()=>{if(!D)return N("No clip copied");let e={id:Date.now().toString(),trackId:D.trackId,startTime:h,endTime:h+(D.endTime-D.startTime),name:"".concat(D.name," (Copy)"),volume:D.volume,fadeIn:D.fadeIn,fadeOut:D.fadeOut,originalTrackId:D.originalTrackId};y(t=>[...t,e])})(),K(null)},disabled:!D,className:"w-full px-4 py-3 text-left text-gray-300 hover:text-white hover:bg-gray-700/50 disabled:text-gray-500 disabled:hover:bg-transparent transition-colors duration-200",children:"Paste"}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),(()=>{if(!v)return N("Please select a clip first");let e=p.find(e=>e.id===v);if(!e)return;let t={id:Date.now().toString(),trackId:e.trackId,startTime:e.endTime+.1,endTime:e.endTime+.1+(e.endTime-e.startTime),name:"".concat(e.name," (Duplicate)"),volume:e.volume,fadeIn:e.fadeIn,fadeOut:e.fadeOut,originalTrackId:e.originalTrackId};y(e=>[...e,t])})(),K(null)},disabled:!v,className:"w-full px-4 py-3 text-left text-gray-300 hover:text-white hover:bg-gray-700/50 disabled:text-gray-500 disabled:hover:bg-transparent transition-colors duration-200",children:"Duplicate"}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),(()=>{if(!v)return N("Please select a clip first");y(e=>e.filter(e=>e.id!==v)),w(null)})(),K(null)},disabled:!v,className:"w-full px-4 py-3 text-left text-gray-300 hover:text-white hover:bg-gray-700/50 disabled:text-gray-500 disabled:hover:bg-transparent transition-colors duration-200",children:"Delete"})]})]}),(0,a.jsxs)("div",{className:"relative dropdown-trigger",children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),K("effects"===J?null:"effects")},className:"px-4 py-2 bg-gradient-to-br from-gray-800/50 to-gray-700/50 hover:from-gray-700/50 hover:to-gray-600/50 rounded-xl border border-gray-600/30 text-gray-300 hover:text-white transition-all duration-200 backdrop-blur-xl",children:"Effects"}),"effects"===J&&(0,a.jsxs)("div",{className:"fixed top-0 left-0 mt-2 w-48 bg-gray-800/90 backdrop-blur-xl rounded-xl border border-gray-600/30 shadow-2xl z-[99999] dropdown-menu",style:{top:"120px",left:"50%",transform:"translateX(-50%)"},children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),(()=>{if(!v)return N("Please select a clip first");y(e=>e.map(e=>e.id===v?{...e,fadeIn:.5}:e))})(),K(null)},disabled:!v,className:"w-full px-4 py-3 text-left text-gray-300 hover:text-white hover:bg-gray-700/50 disabled:text-gray-500 disabled:hover:bg-transparent transition-colors duration-200 rounded-t-xl",children:"Fade In"}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),(()=>{if(!v)return N("Please select a clip first");y(e=>e.map(e=>e.id===v?{...e,fadeOut:.5}:e))})(),K(null)},disabled:!v,className:"w-full px-4 py-3 text-left text-gray-300 hover:text-white hover:bg-gray-700/50 disabled:text-gray-500 disabled:hover:bg-transparent transition-colors duration-200",children:"Fade Out"}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),_(!z),K(null)},className:"w-full px-4 py-3 text-left transition-colors duration-200 rounded-b-xl ".concat(z?"text-blue-400 hover:text-blue-300 hover:bg-blue-900/30":"text-gray-300 hover:text-white hover:bg-gray-700/50"),children:"Selection Mode"})]})]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-4 text-sm",children:(0,a.jsx)("div",{className:"bg-gray-800/50 backdrop-blur-xl rounded-xl border border-gray-600/30 px-4 py-2",children:(0,a.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Start:"}),(0,a.jsx)("span",{className:"bg-gray-700/50 px-2 py-1 rounded-lg text-gray-200 font-mono",children:null!==E?eo(E):"--:--"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"End:"}),(0,a.jsx)("span",{className:"bg-gray-700/50 px-2 py-1 rounded-lg text-gray-200 font-mono",children:null!==O?eo(O):"--:--"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Duration:"}),(0,a.jsx)("span",{className:"bg-gray-700/50 px-2 py-1 rounded-lg text-gray-200 font-mono",children:null!==E&&null!==O?eo(Math.abs(O-E)):"--:--"})]}),(0,a.jsx)("button",{onClick:()=>{P(null),A(null),_(!1)},className:"px-3 py-1 bg-gradient-to-br from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 rounded-lg border border-gray-600/30 text-gray-300 hover:text-white transition-all duration-200 text-xs",children:"Clear"})]})})})]})}),k&&(0,a.jsx)("div",{className:"bg-red-500/20 border border-red-500/30 px-4 py-2",children:(0,a.jsx)("p",{className:"text-red-300 text-sm",children:k})}),(0,a.jsxs)("div",{className:"flex-1 relative z-10",children:[(0,a.jsx)("canvas",{ref:t,width:1200,height:120*x.length+100,className:"w-full cursor-pointer relative z-5",onClick:e=>{if(!et)return;let t=e.currentTarget,r=t.getBoundingClientRect(),a=e.clientX-r.left,l=e.clientY-r.top,i=a/r.width*et,n=Date.now(),o=n-H;if(q(n),o<300){let e=Math.floor(l/120);if(e>=0&&e<x.length){let r=x[e],i=120*e+40;if(l>=i&&l<=i+60){let e=p.find(e=>{if(e.trackId!==r.id)return!1;let l=e.startTime/et*t.width*j,i=(e.endTime-e.startTime)/et*t.width*j;return a>=l&&a<=l+i});e?w(e.id):w(null)}}}else z&&(null===E&&P(i),A(i))},onMouseDown:e=>{if(!et)return;let t=e.currentTarget,r=t.getBoundingClientRect(),a=e.clientX-r.left,l=e.clientY-r.top;g(a/r.width*et);let i=Math.floor(l/120);if(i>=0&&i<x.length){let e=x[i],r=120*i+40;if(l>=r&&l<=r+60){let r=p.find(r=>{if(r.trackId!==e.id)return!1;let l=r.startTime/et*t.width*j,i=(r.endTime-r.startTime)/et*t.width*j;return a>=l&&a<=l+8?(X({clip:r,edge:"start",startX:a}),!0):a>=l+i-8&&a<=l+i?(X({clip:r,edge:"end",startX:a}),!0):a>=l&&a<=l+i});r&&v===r.id&&!U&&(V({clip:r,offsetX:a,offsetY:l}),$(!0))}}B(!0)},onMouseUp:()=>{B(!1),V(null),X(null),$(!1)},onMouseMove:e=>{if(!et)return;let t=e.currentTarget.getBoundingClientRect(),r=e.clientX-t.left,a=e.clientY-t.top,l=r/t.width*et;if(L&&z&&A(l),W&&F){let e=r/t.width*et,l=F.clip.endTime-F.clip.startTime,i=x[Math.floor(a/120)];y(t=>t.map(t=>t.id===F.clip.id?{...t,startTime:Math.max(0,e),endTime:Math.max(0,e)+l,trackId:i?i.id:t.trackId}:t))}if(U){let e=r/t.width*et;y(t=>t.map(t=>{if(t.id!==U.clip.id)return t;if("start"===U.edge){let r=Math.min(e,t.endTime-.1);return{...t,startTime:Math.max(0,r)}}{let r=Math.max(e,t.startTime+.1);return{...t,endTime:Math.min(et,r)}}}))}},onDrop:e=>{if(e.preventDefault(),F){var t;let r=null==(t=x[Math.floor(e.clientY/120)])?void 0:t.id;r&&((e,t)=>{if(!F)return;let r=e.currentTarget.getBoundingClientRect(),a=(e.clientX-r.left)/r.width*et,l={id:Date.now().toString(),trackId:t,startTime:a,endTime:a+(F.clip.endTime-F.clip.startTime),name:F.clip.name,volume:F.clip.volume,fadeIn:F.clip.fadeIn,fadeOut:F.clip.fadeOut,originalTrackId:F.clip.originalTrackId};y(e=>[...e,l]),V(null)})(e,r)}},onDragOver:e=>e.preventDefault()}),(0,a.jsx)("div",{className:"absolute left-2 top-2 space-y-2",children:x.map((e,t)=>(0,a.jsxs)("div",{className:"flex flex-col space-y-1",style:{marginTop:120*t},children:[(0,a.jsx)("div",{className:"text-xs font-bold text-white",children:e.name}),(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("button",{onClick:()=>{var t;return t=e.id,void(b(e=>e.map(e=>e.id===t?{...e,muted:!e.muted}:e)),c&&(p.forEach(e=>{if(e.trackId===t){let t=d.current.get(e.id);if(t){try{t.stop()}catch(e){}d.current.delete(e.id)}}}),setTimeout(()=>er(),50)))},className:"w-6 h-6 text-xs rounded border ".concat(e.muted?"bg-red-600 hover:bg-red-500 text-white":"bg-gray-700 hover:bg-gray-600 text-white"),title:e.muted?"Unmute":"Mute",children:"M"}),(0,a.jsx)("button",{onClick:()=>{var t;return t=e.id,void b(e=>e.map(e=>e.id===t?{...e,soloed:!e.soloed}:e))},className:"w-6 h-6 text-xs rounded border ".concat(e.soloed?"bg-yellow-600 hover:bg-yellow-500 text-white":"bg-gray-700 hover:bg-gray-600 text-white"),title:e.soloed?"Unsolo":"Solo",children:"S"}),(0,a.jsx)("button",{onClick:()=>(e=>{let t=x.find(t=>t.id===e);if(!t)return;let r={id:Date.now().toString(),name:"".concat(t.name," (Copy)"),file:t.file,url:t.url,duration:t.duration,waveformData:t.waveformData,color:ee[x.length%ee.length],volume:t.volume,muted:!1,soloed:!1,leftChannel:t.leftChannel,rightChannel:t.rightChannel};b(e=>[...e,r]);let a=p.filter(t=>t.trackId===e).map(e=>({...e,id:Date.now()+Math.random().toString(),trackId:r.id,name:"".concat(e.name," (Copy)"),originalTrackId:r.id}));y(e=>[...e,...a])})(e.id),className:"w-6 h-6 text-xs rounded border bg-gray-700 hover:bg-gray-600 text-white",title:"Duplicate Track",children:"D"})]})]},e.id))}),(0,a.jsxs)("div",{className:"absolute right-2 top-2 space-y-2",children:[(0,a.jsx)("div",{className:"text-xs font-bold",children:"L ON"}),(0,a.jsx)("div",{className:"text-xs font-bold",children:"R ON"}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(i.$,{className:"bg-gray-700 hover:bg-gray-600 w-6 h-6 text-xs",children:"1+"}),(0,a.jsx)(i.$,{className:"bg-gray-700 hover:bg-gray-600 w-6 h-6 text-xs",children:"1-"}),(0,a.jsx)(i.$,{className:"bg-gray-700 hover:bg-gray-600 w-6 h-6 text-xs",children:"[R]"})]})]}),0===x.length&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-white/60 text-lg mb-4",children:"Drag n drop an Audio File in this window, or click"}),(0,a.jsx)(i.$,{onClick:e=>{var t;e.stopPropagation(),null==(t=document.getElementById("file-upload"))||t.click()},className:"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 px-6 py-3 rounded-xl border border-purple-500/30 text-white font-medium transition-all duration-200 shadow-lg",children:"here to use a sample"})]})})]}),(0,a.jsx)("div",{className:"bg-gray-800 border-t border-gray-700 px-4 py-2",children:(0,a.jsxs)("div",{className:"flex justify-between text-xs text-gray-400",children:[(0,a.jsx)("span",{children:"-Inf"}),(0,a.jsx)("span",{children:"-70"}),(0,a.jsx)("span",{children:"-60"}),(0,a.jsx)("span",{children:"-50"}),(0,a.jsx)("span",{children:"-40"}),(0,a.jsx)("span",{children:"-30"}),(0,a.jsx)("span",{children:"-20"}),(0,a.jsx)("span",{children:"-10"}),(0,a.jsx)("span",{children:"0"})]})}),(0,a.jsx)("audio",{ref:e,style:{display:"none"}})]})}},8957:(e,t,r)=>{Promise.resolve().then(r.bind(r,4054))}},e=>{e.O(0,[441,964,358],()=>e(e.s=8957)),_N_E=e.O()}]);